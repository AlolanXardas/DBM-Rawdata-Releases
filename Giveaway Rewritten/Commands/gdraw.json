{
  "name": "gdraw",
  "permissions": "NONE",
  "restriction": "1",
  "_id": "mXltB",
  "actions": [
    {
      "storage": "0",
      "varName": "",
      "name": "Delete Message"
    },
    {
      "message": "0",
      "varName": "",
      "info": "0",
      "ParamN": "1",
      "separator": "",
      "storage": "1",
      "varName2": "giveawayWinners",
      "name": "Store Message Params"
    },
    {
      "behavior": "0",
      "interpretation": "1",
      "code": "const Discord = require(\"discord.js\");\nconst giveawayWinners = tempVars(\"giveawayWinners\");\n\nasync function drawWinner() {\n    if (!isNaN(giveawayWinners) && giveawayWinners > 0 && giveawayWinners != null) {\n        var serverMessages = await msg.channel.fetchMessages({\n            limit: 100\n        });\n        serverMessages = serverMessages.array();\n        serverMessages = serverMessages.filter(object => object.author.id == client.user.id);\n        let messagesList = [];\n        let winnerArray = [];\n        let winnerText = \"\";\n\n        for (i = 0; i < serverMessages.length; i++) {\n            if (serverMessages[i][\"embeds\"][0] != null && serverMessages[i][\"embeds\"][0][\"author\"][\"name\"] != null && serverMessages[i].reactions.get('ðŸŽ‰') != null) {\n                let giveawayEmbed = serverMessages[i][\"embeds\"][0];\n                if (giveawayEmbed[\"author\"][\"name\"].includes(\"ðŸŽ‰\") && giveawayEmbed[\"author\"][\"name\"].includes(\"Giveaway\")) {\n                    messagesList.push(serverMessages[i]);\n                }\n            }\n        }\n\n        if (messagesList.length > 0) {\n            let giveawayMessage = messagesList[messagesList.length - 1];\n            let giveawayUsers = await giveawayMessage.reactions.get('ðŸŽ‰').fetchUsers();\n            giveawayUsers = await giveawayUsers.array();\n            giveawayUsers = await giveawayUsers.filter(object => object.id != client.user.id);\n            if (giveawayUsers.length > 0) {\n                if (giveawayUsers.length > giveawayWinners) {\n                    for (var i = 0; i < giveawayWinners; i++) {\n                        var randomNumber = Math.floor(Math.random() * giveawayUsers.length);\n                        var randomuser = giveawayUsers[randomNumber];\n                        winnerArray.push(randomuser);\n                        giveawayUsers.splice(giveawayUsers.indexOf(randomNumber), randomNumber);\n                    }\n                } else if (giveawayUsers.length <= giveawayWinners) {\n                    for (i = 0; i < giveawayUsers.length; i++) {\n                        winnerArray.push(giveawayUsers[i]);\n                    }\n                }\n\n                for (i = 0; i < winnerArray.length; i++) {\n                    winnerText = winnerText + winnerArray[i] + '\\n';\n                }\n\n                msg.channel.send(\"ðŸŽ‰ Giveaway Redraw ðŸŽ‰\\n\\n\" + winnerText);\n\n            } else {\n                errorMessage(\"No one reacted in the recent giveaway hosted, cannot draw a member!\");\n            }\n        } else {\n            errorMessage(\"There is no recent giveaway hosted, cannot draw a member!\");\n        }\n    } else {\n        errorMessage(\"Please enter a valid amount of players to be selected to win!\")\n    }\n\n    function errorMessage(error) {\n        let errorTemplate = new Discord.RichEmbed({\n            color: 0xFF0000,\n            author: {\n                name: client.user.username,\n                icon_url: client.user.avatarURL\n            },\n            title: \"Giveaway Draw\",\n            description: error,\n            timestamp: new Date(),\n        })\n\n        msg.channel.send(errorTemplate);\n    }\n}\n\nif (msg.member.hasPermission('MANAGE_CHANNELS', false, false)) {\n    drawWinner();\n} else {\n    errorMessage(\"You don't have the permission to execute the command!\");\n}",
      "storage": "0",
      "varName": "",
      "name": "Run Script"
    }
  ]
}